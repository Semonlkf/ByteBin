{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Navigation from \"@/components/Navigation\";\nimport { getArticleDetail, postArticle, update } from \"@/api/Article\";\nimport { uploadFile } from \"@/api/Common\";\nexport default {\n  name: \"Write\",\n  data() {\n    return {\n      id: String,\n      inputVisible: false,\n      inputValue: '',\n      article: {\n        title: '',\n        content: '',\n        tags: [],\n        description: ''\n      },\n      tags: [],\n      editor: {\n        value: ''\n      },\n      flag: 0\n    };\n  },\n  methods: {\n    handleClose(tag) {\n      this.tags.splice(this.tags.indexOf(tag), 1);\n    },\n    showInput() {\n      this.inputVisible = true;\n      this.$nextTick(_ => {\n        this.$refs.saveTagInput.$refs.input.focus();\n      });\n    },\n    handleInputConfirm() {\n      let inputValue = this.inputValue;\n      if (inputValue) {\n        this.tags.push(inputValue);\n      }\n      this.inputVisible = false;\n      this.inputValue = '';\n    },\n    postArticle() {\n      this.article.content = this.$refs.md.d_value;\n      this.article.tags = this.tags;\n      console.log(this.article);\n      if (this.id) {\n        this.article.id = this.id;\n        update(JSON.stringify(this.article)).then(res => {\n          if (res.code == 2001) {\n            this.$notify({\n              title: \"Bloggy\",\n              message: res.message,\n              type: \"success\",\n              duration: 2000\n            });\n            this.flag = 1;\n            this.$router.push(\"/home\");\n          } else {\n            this.$notify({\n              title: \"Bloggy\",\n              message: res.message,\n              type: \"error\",\n              duration: 1000\n            });\n          }\n        });\n      } else {\n        postArticle(JSON.stringify(this.article)).then(res => {\n          if (res.code == 2001) {\n            this.$notify({\n              title: \"Bloggy\",\n              message: res.message,\n              type: \"success\",\n              duration: 2000\n            });\n            this.flag = 1;\n            this.$router.push(\"/home\");\n          } else {\n            this.$notify({\n              title: \"Bloggy\",\n              message: res.message,\n              type: \"error\",\n              duration: 1000\n            });\n          }\n        });\n      }\n    },\n    imgAdd(pos, file) {\n      // 上传图片\n      let formData = new FormData();\n      formData.append('image', file);\n      uploadFile(formData).then(res => {\n        // 第二步.将返回的url替换到文本原位置![...](./0) -> ![...](url)\n        /**\n         * $vm 指为mavonEditor实例，可以通过如下两种方式获取\n         * 1.  通过引入对象获取: `import {mavonEditor} from ...` 等方式引入后，`$vm`为`mavonEditor`\n         * 2. 通过$refs获取: html声明ref : `<mavon-editor ref=md ></mavon-editor>，`$vm`为 `this.$refs.md`\n         *\n         */\n        this.$refs.md.$img2Url(pos, res.data.path);\n      });\n    },\n    getDetail() {\n      getArticleDetail(this.id).then(res => {\n        this.article = res.data.article;\n        this.tags = res.data.article.tags;\n        this.editor.value = this.article.content;\n      });\n    }\n  },\n  components: {\n    'navigation': Navigation\n  },\n  beforeDestroy() {\n    let value = this.$refs.md.d_value;\n    if (this.flag == 0) {\n      this.$cookie.set(\"draft\", value, 24 * 60 * 60 * 30);\n    } else {\n      this.$cookie.delete(\"draft\");\n    }\n  },\n  created() {\n    this.id = this.$route.query.id;\n    if (this.id) {\n      this.getDetail();\n    }\n    return;\n    this.editor.value = this.$cookie.get(\"draft\");\n  }\n};","map":{"version":3,"names":["Navigation","getArticleDetail","postArticle","update","uploadFile","name","data","id","String","inputVisible","inputValue","article","title","content","tags","description","editor","value","flag","methods","handleClose","tag","splice","indexOf","showInput","$nextTick","_","$refs","saveTagInput","input","focus","handleInputConfirm","push","md","d_value","console","log","JSON","stringify","then","res","code","$notify","message","type","duration","$router","imgAdd","pos","file","formData","FormData","append","$img2Url","path","getDetail","components","beforeDestroy","$cookie","set","delete","created","$route","query","get"],"sources":["src/views/Write.vue"],"sourcesContent":["<template>\n  <el-container>\n    <el-container>\n      <el-aside style=\"width: 15%;margin-left: 20px;overflow: visible\">\n        <el-tag v-for=\"tag in tags\"\n                :key=\"tag\"\n                :disable-transitions=\"false\"\n                class=\"article-tag\"\n                closable\n                effect=\"dark\"\n                @close=\"handleClose(tag)\">\n          {{ tag }}\n        </el-tag>\n        <el-input\n            v-if=\"inputVisible\"\n            ref=\"saveTagInput\"\n            v-model=\"inputValue\"\n            class=\"input-new-tag\"\n            size=\"small\"\n            @blur=\"handleInputConfirm\"\n            @keyup.enter.native=\"handleInputConfirm\"\n        >\n        </el-input>\n        <el-button v-else class=\"button-new-tag\" size=\"small\" style=\"position: absolute;margin-top: 10px\"\n                   @click=\"showInput\">+ New Tag\n        </el-button>\n      </el-aside>\n      <el-main>\n        <div id=\"title\">\n          <el-input v-model=\"article.title\" autosize maxlength=\"50\" placeholder=\"请输入标题\" show-word-limit\n                    style=\"width: 70%;float: left;font-size: 18px\" type=\"textarea\"></el-input>\n          <el-button round style=\"float: right\" type=\"primary\" @click=\"postArticle\">发布</el-button>\n        </div>\n\n        <div id=\"editor\">\n          <mavon-editor ref=\"md\"\n                        v-model=\"editor.value\" style=\"width: 100%;margin-top: 30px\" @imgAdd=\"imgAdd\"/>\n        </div>\n\n      </el-main>\n    </el-container>\n\n  </el-container>\n</template>\n\n<script>\nimport Navigation from \"@/components/Navigation\";\nimport {getArticleDetail, postArticle, update} from \"@/api/Article\";\nimport {uploadFile} from \"@/api/Common\";\n\nexport default {\n  name: \"Write\",\n\n  data() {\n    return {\n      id: String,\n      inputVisible: false,\n      inputValue: '',\n      article: {\n        title: '',\n        content: '',\n        tags: [],\n        description: ''\n      },\n      tags: [],\n      editor: {\n        value: '',\n      },\n      flag: 0\n    }\n  },\n  methods: {\n    handleClose(tag) {\n      this.tags.splice(this.tags.indexOf(tag), 1);\n    },\n\n    showInput() {\n      this.inputVisible = true;\n      this.$nextTick(_ => {\n        this.$refs.saveTagInput.$refs.input.focus();\n      });\n    },\n\n    handleInputConfirm() {\n      let inputValue = this.inputValue;\n      if (inputValue) {\n        this.tags.push(inputValue);\n      }\n      this.inputVisible = false;\n      this.inputValue = '';\n    },\n    postArticle() {\n      this.article.content = this.$refs.md.d_value\n      this.article.tags = this.tags\n      console.log(this.article)\n      if (this.id) {\n        this.article.id = this.id\n        update(JSON.stringify(this.article)).then((res) => {\n          if (res.code == 2001) {\n            this.$notify({\n              title: \"Bloggy\",\n              message: res.message,\n              type: \"success\",\n              duration: 2000\n            })\n            this.flag = 1\n            this.$router.push(\"/home\")\n          } else {\n            this.$notify({\n              title: \"Bloggy\",\n              message: res.message,\n              type: \"error\",\n              duration: 1000\n            })\n          }\n        })\n      } else {\n        postArticle(JSON.stringify(this.article)).then((res) => {\n          if (res.code == 2001) {\n            this.$notify({\n              title: \"Bloggy\",\n              message: res.message,\n              type: \"success\",\n              duration: 2000\n            })\n            this.flag = 1\n            this.$router.push(\"/home\")\n          } else {\n            this.$notify({\n              title: \"Bloggy\",\n              message: res.message,\n              type: \"error\",\n              duration: 1000\n            })\n          }\n        })\n\n      }\n    },\n    imgAdd(pos, file) {\n// 上传图片\n      let formData = new FormData()\n      formData.append('image', file)\n      uploadFile(formData).then((res) => {\n        // 第二步.将返回的url替换到文本原位置![...](./0) -> ![...](url)\n        /**\n         * $vm 指为mavonEditor实例，可以通过如下两种方式获取\n         * 1.  通过引入对象获取: `import {mavonEditor} from ...` 等方式引入后，`$vm`为`mavonEditor`\n         * 2. 通过$refs获取: html声明ref : `<mavon-editor ref=md ></mavon-editor>，`$vm`为 `this.$refs.md`\n         *\n         */\n        this.$refs.md.$img2Url(pos, res.data.path)\n      })\n    },\n    getDetail() {\n      getArticleDetail(this.id).then((res) => {\n        this.article = res.data.article\n        this.tags = res.data.article.tags\n        this.editor.value = this.article.content\n      })\n    }\n  },\n  components: {\n    'navigation': Navigation\n  },\n  beforeDestroy() {\n    let value = this.$refs.md.d_value\n    if (this.flag == 0) {\n      this.$cookie.set(\"draft\", value, 24 * 60 * 60 * 30)\n    } else {\n      this.$cookie.delete(\"draft\")\n    }\n  },\n  created() {\n    this.id = this.$route.query.id\n    if (this.id) {\n      this.getDetail()\n    }\n    return\n    this.editor.value = this.$cookie.get(\"draft\")\n  }\n}\n</script>\n\n<style scoped>\n#editor {\n  width: 80%;\n  text-align: center;\n  margin: 100px auto 20px;\n}\n\n#title {\n  width: 80%;\n  text-align: center;\n  background-color: #42b983;\n  margin: 0 auto 0;\n}\n\nli {\n  list-style-type: none;\n}\n\n.el-tag {\n  white-space: normal;\n  height: auto;\n  text-align: left;\n  border-radius: 8px;\n  float: left;\n  margin-left: 10px;\n  margin-top: 10px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}